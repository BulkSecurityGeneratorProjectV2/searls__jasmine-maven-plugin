<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultSpecRunnerHtmlGenerator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jasmine-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">com.github.searls.jasmine.runner</a> &gt; <span class="el_source">DefaultSpecRunnerHtmlGenerator.java</span></div><h1>DefaultSpecRunnerHtmlGenerator.java</h1><pre class="source lang-java linenums">package com.github.searls.jasmine.runner;

import com.github.searls.jasmine.io.scripts.ScriptResolver;
import com.github.searls.jasmine.io.scripts.ScriptResolverException;
import org.apache.commons.lang3.StringUtils;
import org.stringtemplate.v4.ST;

import java.io.IOException;
import java.util.Arrays;
import java.util.Set;

public class DefaultSpecRunnerHtmlGenerator extends AbstractSpecRunnerHtmlGenerator implements SpecRunnerHtmlGenerator {

  protected DefaultSpecRunnerHtmlGenerator(HtmlGeneratorConfiguration configuration) {
<span class="fc" id="L15">    super(configuration);</span>
<span class="fc" id="L16">  }</span>

  @Override
  public String generate() {
    try {
<span class="nc" id="L21">      ScriptResolver resolver = this.getConfiguration().getScriptResolver();</span>
<span class="nc" id="L22">      return this.generateHtml(</span>
<span class="nc" id="L23">        resolver.getAllScripts(),</span>
<span class="nc" id="L24">        resolver.getPreloads(),</span>
<span class="nc" id="L25">        resolver.getSources(),</span>
<span class="nc" id="L26">        resolver.getSpecs(),</span>
<span class="nc" id="L27">        resolver.getSourceDirectory(),</span>
<span class="nc" id="L28">        resolver.getSpecDirectory()</span>
      );
<span class="nc" id="L30">    } catch (ScriptResolverException e) {</span>
<span class="nc" id="L31">      throw new RuntimeException(&quot;Failed to load files for dependencies, sources, or a custom runner&quot;, e);</span>
<span class="nc" id="L32">    } catch (IOException e) {</span>
<span class="nc" id="L33">      throw new RuntimeException(&quot;Failed to load files for dependencies, sources, or a custom runner&quot;, e);</span>
    }
  }

  private String generateHtml(Set&lt;String&gt; allScripts,
                              Set&lt;String&gt; preloads,
                              Set&lt;String&gt; sources,
                              Set&lt;String&gt; specs,
                              String sourceDirectory,
                              String specDirectory) throws IOException {
<span class="nc" id="L43">    ST template = this.resolveHtmlTemplate();</span>
<span class="nc" id="L44">    this.applyScriptTagsToTemplate(</span>
      JAVASCRIPT_DEPENDENCIES_TEMPLATE_ATTR_NAME,
<span class="nc" id="L46">      Arrays.asList(JASMINE_JS, JASMINE_HTML_JS, JASMINE_HTMLSPECFILTER_PATCH_JS, JASMINE_BOOT_JS),</span>
      template);
<span class="nc" id="L48">    this.applyCssToTemplate(Arrays.asList(JASMINE_CSS), template);</span>
<span class="nc" id="L49">    this.applyScriptTagsToTemplate(&quot;allScriptTags&quot;, allScripts, template);</span>
<span class="nc" id="L50">    this.applyScriptTagsToTemplate(&quot;preloadScriptTags&quot;, preloads, template);</span>
<span class="nc" id="L51">    this.applyScriptTagsToTemplate(&quot;sourceScriptTags&quot;, sources, template);</span>
<span class="nc" id="L52">    this.applyScriptTagsToTemplate(&quot;specScriptTags&quot;, specs, template);</span>
<span class="nc" id="L53">    template.add(&quot;allScriptsList&quot;, this.createJsonArray(allScripts));</span>
<span class="nc" id="L54">    template.add(&quot;preloadsList&quot;, this.createJsonArray(preloads));</span>
<span class="nc" id="L55">    template.add(&quot;sourcesList&quot;, this.createJsonArray(sources));</span>
<span class="nc" id="L56">    template.add(&quot;specsList&quot;, this.createJsonArray(specs));</span>
<span class="nc" id="L57">    template.add(&quot;sourceDir&quot;, sourceDirectory);</span>
<span class="nc" id="L58">    template.add(&quot;specDir&quot;, specDirectory);</span>

<span class="nc" id="L60">    template.add(&quot;autoRefresh&quot;, this.getConfiguration().getAutoRefresh());</span>
<span class="nc" id="L61">    template.add(&quot;autoRefreshInterval&quot;, this.getConfiguration().getAutoRefreshInterval());</span>

<span class="nc" id="L63">    this.setCustomRunnerConfig(template);</span>
<span class="nc" id="L64">    template.add(REPORTER_ATTR_NAME, this.getConfiguration().getReporterType().name());</span>
<span class="nc" id="L65">    this.setEncoding(this.getConfiguration(), template);</span>

    // these fields are being preserved for backwards compatibility
<span class="nc" id="L68">    this.applyScriptTagsToTemplate(&quot;sources&quot;, allScripts, template);</span>
<span class="nc" id="L69">    template.add(&quot;specs&quot;, this.createJsonArray(specs));</span>
<span class="nc" id="L70">    template.add(&quot;priority&quot;, this.createJsonArray(preloads));</span>

<span class="nc" id="L72">    return template.render();</span>
  }

  private String createJsonArray(Set&lt;String&gt; scripts) {
<span class="nc bnc" id="L76" title="All 4 branches missed.">    if (null == scripts || scripts.isEmpty()) {</span>
<span class="nc" id="L77">      return &quot;[]&quot;;</span>
    }
<span class="nc" id="L79">    StringBuilder builder = new StringBuilder(&quot;['&quot;);</span>
<span class="nc" id="L80">    builder.append(StringUtils.join(scripts, &quot;', '&quot;));</span>
<span class="nc" id="L81">    builder.append(&quot;']&quot;);</span>
<span class="nc" id="L82">    return builder.toString();</span>
  }

  private void setCustomRunnerConfig(ST template) throws IOException {
<span class="nc" id="L86">    String customRunnerConfiguration = this.getConfiguration().getCustomRunnerConfiguration();</span>
<span class="nc" id="L87">    template.add(&quot;customRunnerConfiguration&quot;, customRunnerConfiguration);</span>
<span class="nc" id="L88">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>